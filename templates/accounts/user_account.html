{% extends "home/base.html" %}
{% load crispy_forms_tags %}


{% block content %}
<br><br>
<div class="user_div">
    <div class="container">
        <div class="col-xs-8 col-xs-offset-2">
            {% if user.id == request.user.id %}
            <h2>Welcome to your profile!</h2>
                <hr>
                <h2>Your favourite posts:</h2>
                <div class="row">
                {% for favorite_post in userprofile.favorite_posts.all  %}
                    {% if forloop.counter0|divisibleby:4 %}
                        </div><br><div class="row">
                    {% endif %}

                    <div id="{{ favorite_post.id }}" class="card" style="margin-left: 15px; margin-bottom: 15px; height: 350px; width: 265px;">
                      <div class="view overlay">
                        <img class="card-img-top" src="{{ favorite_post.image.url }}" alt="Card image cap">
                        <a>
                          <div class="mask rgba-white-slight"></div>
                        </a>
                      </div>
                      <div class="card-body">
                        <a class="activator waves-effect waves-light mr-4"><i class="fa fa-share-alt"></i></a>
                        <h4 class="card-title">{{ favorite_post.title }}</h4>
                        <hr>
                        <p class="card-text">{{ favorite_post.content|truncatechars:20 }}</p>
                        <a href="{{ favorite_post.get_absolute_url }}" class="black-text d-flex justify-content-end"><h5>Read more<i class="fa fa-angle-double-right"></i></h5></a>
                        <a href="" id="{{ favorite_post.id }}" data-id="{{ favorite_post.id}}" class="favorite_add_remove red-text d-flex justify-content-end"><h6>Remove</h6></a>
                      </div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <h2>Welcome to {{ user.username }}'s profile!</h2>
            {% endif %}
            <br>
            <div class="user_account rounded">
                <h3>Username: {{ user.username }}</h3>
                <h3>Email: {{ user.email }}</h3>

                {% if userprofile.image %}
                    <h3>Profile image: </h3>
                    <img class="profileimg" src="{{ userprofile.image.url }}" alt="">
                {% else %}
                    <h3>Profile image: -</h3>
                {% endif %}
                <br>
                <br>
                {% if user.first_name %}
                    <h3>First name: {{ user.first_name }}</h3>
                {% else %}
                    <h3>First name: -</h3>
                {% endif %}
                {% if user.last_name %}
                    <h3>Last name: {{ user.last_name }}</h3>
                {% else %}
                    <h3>Last name: -</h3>
                {% endif %}<h4>Registration date: {{ user.date_joined }}</h4>
            </div>
            <br>
            {% if request.user == user %}
                <h2>Upload profile image:</h2>
                <form action="." method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <input type="submit" class="btn btn-success" value="Send">
                </form>
                <hr>

                <a href="{% url "logout_view" %}" class="btn btn-warning btn-lg">Logout</a>
            {% endif %}
                <a href="{% url "post:home_page" %}" class="btn btn-primary btn-lg">Back to posts</a>

        </div>
    </div>
    <br><br><br>
</div>

<script>
$(document).ready(function(){
    $('.favorite_add_remove').on('click', function (e) {
        e.preventDefault();
        var post_id = $(this).attr('data-id');
        console.log(post_id)
        var url_ajax = "{% url 'post:add_to_favorite' id=123 %}".replace('/123/', '/'+String(post_id)+'/');
        data = {
            post_id: post_id,
        };
        console.log(url_ajax);
        $.ajax({
            type: "GET",
            url: url_ajax,
            dataType: "json",
            data: data,
            success: function (data) {
                document.getElementById(post_id).remove();
            }
        })

    })
})
</script>

{% endblock %}
